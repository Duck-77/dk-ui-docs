import{d as U,L as z,h as u,p as f,a5 as G,q as P,o as s,c as r,G as b,w as k,F as _,C as Z,n as y,Z as g,b as S,k as C,t as J,a as B,j as Q}from"./framework.C2_qfHdj.js";import{d as X,_ as Y}from"./Tooltip.vue_vue_type_script_setup_true_lang.e6xadD7A.js";import{_ as ee}from"./Input.vue_vue_type_script_setup_true_lang.BztRnexZ.js";import{_ as w}from"./Icon.vue_vue_type_script_setup_true_lang.CaVVuClK.js";import{R as te}from"./Render.BipKa-0U.js";import{f as le}from"./FormItem.DI4IDgGP.js";const ne={class:"dk-select__icon"},oe={key:0,class:"dk-select--loading"},ae={key:1,class:"dk-select__menu"},se=["id","onClick"],ie={key:1},re={key:2,class:"dk-select__nothing"},he=U({name:"DkSelect",__name:"Select",props:{modelValue:{},options:{default:()=>[]},placeholder:{},clearable:{type:Boolean},disabled:{type:Boolean},customLabel:{},filterable:{type:Boolean},filterMethod:{},remote:{type:Boolean},remoteMethod:{}},emits:["change","visible-change","update:modelValue","clear"],setup($,{emit:D}){const F=()=>{const t=l.options.find(n=>n.value===l.modelValue);return t||null},l=$,c=D,p=z(le,void 0),R=u(()=>!!p),V=f(),m=f(),L=u(()=>!l.filterable||!i.value),H={modifiers:[{name:"offset",options:{offset:[0,9]}},{name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:t})=>{t.styles.popper.width=`${t.rects.reference.width}px`},effect:({state:t})=>{t.elements.popper.style.width=`${t.elements.reference.offsetWidth}px`}}]},N=F(),e=G({inputValue:l.modelValue,selectedOption:N,selectHover:!1,loading:!1,currentSelectedIndex:-1}),o=f(l.options);P(()=>l.options,t=>{o.value=t});const T=u(()=>i.value&&e.selectedOption?e.selectedOption.label:l.placeholder),E=u(()=>l.remote?500:0),v=async t=>{if(l.filterable){if(l.filterMethod&&typeof l.filterMethod=="function")o.value=l.filterMethod(t);else if(l.remote&&l.remoteMethod&&typeof l.remoteMethod=="function"){e.loading=!0;try{o.value=await l.remoteMethod(t)}catch(n){console.error(n),o.value=[]}finally{e.loading=!1}}else o.value=l.options.filter(n=>n.label.includes(t));e.currentSelectedIndex=-1}},K=async()=>{l.filterable&&l.remote&&l.remoteMethod&&(o.value=await l.remoteMethod(""))},W=X(v,E.value),i=f(!1),j=u(()=>l.clearable&&e.selectHover&&e.selectedOption&&e.inputValue.trim()!==""),q=()=>{e.inputValue="",e.selectedOption=null,c("clear"),c("change",""),c("update:modelValue",""),h("change"),h("clear")},I=t=>{var n,a;t?(e.selectedOption&&(e.inputValue=""),l.filterable&&(o.value=l.options),(n=m.value)==null||n.onShow()):(e.selectedOption&&(e.inputValue=e.selectedOption.label),e.currentSelectedIndex=-1,(a=m.value)==null||a.onHide())},d=()=>{l.disabled||(i.value=!i.value,i.value?(I(!0),v(e.inputValue)):I(!1),c("visible-change",i.value))},O=t=>{var n;t.disabled||(e.inputValue=t.label,e.selectedOption=t,c("change",t.label),c("update:modelValue",t.label),h("change"),(n=V.value)==null||n.focus(),d())},A=t=>{switch(t.key){case"Enter":i.value?e.currentSelectedIndex>-1&&o.value[e.currentSelectedIndex]?O(o.value[e.currentSelectedIndex]):d():(d(),v(e.inputValue));break;case"Escape":i.value&&d();break;case"ArrowUp":t.preventDefault(),o.value.length&&(e.currentSelectedIndex===-1||e.currentSelectedIndex===0?e.currentSelectedIndex=o.value.length-1:e.currentSelectedIndex--);break;case"ArrowDown":t.preventDefault(),o.value.length&&(e.currentSelectedIndex===-1||e.currentSelectedIndex===o.value.length-1?e.currentSelectedIndex=0:e.currentSelectedIndex++);break}},h=t=>{R.value&&(p==null||p.validate(t).catch(n=>{console.log("validate failed:",n.errors)}))};return(t,n)=>(s(),r("div",{class:y(["dk-select",{"is-disabled":t.disabled}]),onClick:d,onMouseenter:n[1]||(n[1]=a=>e.selectHover=!0),onMouseleave:n[2]||(n[2]=a=>e.selectHover=!1)},[b(Y,{ref_key:"toolTipRef",ref:m,effect:"light","popper-options":H,placement:"bottom-start",manual:"",onClickOutside:d},{content:k(()=>[e.loading?(s(),r("div",oe,[b(w,{icon:"spinner",spin:""})])):o.value.length?(s(),r("ul",ae,[(s(!0),r(_,null,Z(o.value,(a,x)=>{var M;return s(),r("li",{key:x,class:y(["dk-select__menu-item",{"is-disabled":a.disabled,"is-selected":((M=e.selectedOption)==null?void 0:M.value)===a.value,"is-highlight":e.currentSelectedIndex===x}]),id:`dk-select-item-${a.value}`,onClick:g(ce=>O(a),["stop"])},[t.customLabel?(s(),S(C(te),{key:0,vnode:t.customLabel?t.customLabel(a):a.label},null,8,["vnode"])):(s(),r("span",ie,J(a.label),1))],10,se)}),128))])):(s(),r("div",re,[t.remote?(s(),r(_,{key:0},[B(" No Data ")],64)):(s(),r(_,{key:1},[B(" No matching data ")],64))]))]),default:k(()=>[b(ee,{ref_key:"inputRef",ref:V,readonly:L.value,class:"dk-select__tooltip-trigger",modelValue:e.inputValue,"onUpdate:modelValue":n[0]||(n[0]=a=>e.inputValue=a),onFocus:K,onInput:C(W),onKeydown:A,disabled:t.disabled,placeholder:T.value},{suffix:k(()=>[Q("span",ne,[j.value?(s(),S(w,{key:0,class:"dk-select__clear",icon:"fa-regular fa-circle-xmark",onMousedown:g(()=>{},["prevent"]),onClick:g(q,["stop"])})):(s(),S(w,{key:1,class:y(["dk-select__angle-down",{"is-active":i.value}]),icon:"angle-down"},null,8,["class"]))])]),_:1},8,["readonly","modelValue","onInput","disabled","placeholder"])]),_:1},512)],34))}});export{he as _};
