import{p as m,h as d,a9 as O,q as S,v as M,x as D,k as u,d as N,o as g,b as $,w as F,c as h,n as V,N as H,j,G as y,r as q,e as w,T as A,P as _,ad as G,ae as x,a4 as P}from"./framework.C2_qfHdj.js";import{R as U}from"./Render.BipKa-0U.js";import{_ as J}from"./Icon.vue_vue_type_script_setup_true_lang.CaVVuClK.js";import{T as K}from"./TypeIcon.Bi5XwFKK.js";const T=m(0),Q=(o=2e3)=>{const s=m(o),t=d(()=>T.value+s.value);return{init:s,current:t,next:()=>(T.value++,t.value)}},W=(o,s,t)=>{O(o)?S(o,(e,a)=>{a==null||a.removeEventListener(s,t),e==null||e.addEventListener(s,t)}):M(()=>{o.addEventListener(s,t)}),D(()=>{var e;(e=u(o))==null||e.removeEventListener(s,t)})},X=(o,s)=>{let t;return{startTimer:()=>{t=setTimeout(()=>{s()},o)},clearTimer:()=>{clearTimeout(t)}}},Y={class:"dk-message__content"},Z=N({name:"DkMessage",__name:"Message",props:{id:{},message:{},duration:{default:3e3},showClose:{type:Boolean},type:{default:"info"},offset:{default:20},zIndex:{},plain:{type:Boolean},icon:{},onDestory:{},onShow:{type:Function,default:()=>{}},onClose:{type:Function,default:()=>{}},onClickClose:{type:Function,default:()=>{}}},emits:["show","close","click-close"],setup(o,{expose:s,emit:t}){const e=o,a=m(),l=m(!1),f=m(0),p=d(()=>se(e.id)),i=d(()=>e.offset+p.value),c=d(()=>i.value+f.value),B=d(()=>({top:i.value+"px",zIndex:e.zIndex})),{startTimer:k,clearTimer:C}=X(e.duration,()=>{l.value=!1}),E=()=>{e.onShow(),!(e.duration<=0)&&k()},I=()=>{e.onClose(),e.duration>0&&k()},z=()=>{l.value=!1,e.onClickClose()},L=()=>{e.onDestory()},R=async()=>{await _(),f.value=a.value.getBoundingClientRect().height};return s({bottomOffset:c,visible:l}),W(document,"keydown",n=>{n.code==="Escape"&&(l.value=!1)}),M(async()=>{l.value=!0,E()}),(n,v)=>(g(),$(A,{name:"fade-down-up",onAfterLeave:L,onEnter:R},{default:F(()=>[l.value?(g(),h("div",{key:0,ref_key:"messageRef",ref:a,class:V(["dk-message",{[`dk-message--${n.type}`]:n.type,"is-close":n.showClose,"is-plain":n.plain}]),style:H(B.value),role:"alert",onMouseenter:v[0]||(v[0]=(...b)=>u(C)&&u(C)(...b)),onMouseleave:I},[j("div",Y,[y(u(K),{type:n.icon??n.type,class:"dk-message-icon"},null,8,["type"]),q(n.$slots,"default",{},()=>[y(u(U),{vnode:n.message},null,8,["vnode"])])]),n.showClose?(g(),h("span",{key:0,class:"dk-message__close",onClick:z},[y(J,{icon:"xmark"})])):w("",!0)],38)):w("",!0)]),_:3}))}});let ee=1;const r=G([]),le=o=>{const s=`dk_message_${ee++}`,{next:t}=Q(),e=document.createElement("div"),a={...o,id:s,zIndex:t(),onDestory:()=>{const i=r.findIndex(c=>c.id===s);i!==-1&&(r.splice(i,1),x(null,e))}},l=P(Z,a);x(l,e);const f=()=>{const i=r.find(c=>c.id===s);i&&(i.vm.exposed.visible.value=!1)},p={id:s,vnode:l,vm:l.component,props:a,destory:f};return r.push(p),_(()=>{document.body.appendChild(e.firstElementChild)}),p},se=o=>{const s=r.findIndex(t=>t.id===o);return s<=0?0:r[s-1].vm.exposed.bottomOffset.value};export{le as c};
